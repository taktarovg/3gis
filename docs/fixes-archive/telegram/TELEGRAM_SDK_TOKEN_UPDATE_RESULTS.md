# üõ†Ô∏è –†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ò–°–¢–ï–ú–´ –¢–û–ö–ï–ù–û–í –ò SDK v3.x

## ‚úÖ **–ß–¢–û –ë–´–õ–û –í–´–ü–û–õ–ù–ï–ù–û:**

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å @telegram-apps/sdk v3.3.1:**
- ‚úÖ **–£–±—Ä–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SSR —Ñ–ª–∞–≥** –∏–∑ `useLaunchParams(true)` ‚Üí `useLaunchParams()`
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏–º `tgWebAppData` 
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω TelegramProvider** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π SDK —á–µ—Ä–µ–∑ `init()`
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω layout** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `SDKProvider` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 2. **–°–æ–∑–¥–∞–Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏:**
- ‚úÖ **use-token-manager.ts** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞–º–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh
- ‚úÖ **token-refresh-service.ts** - —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **api-client.ts** - HTTP –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω use-telegram-auth.ts** —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 3. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã SDK v3.x:**
- ‚úÖ **TelegramProvider.tsx** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è SDK v3.x
- ‚úÖ **TelegramSDKTest.tsx** - —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω TelegramAuth.tsx** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** –∑–∞ 1 —á–∞—Å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üìÅ **–°–û–ó–î–ê–ù–ù–´–ï/–û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:**

### –•—É–∫–∏:
- `src/hooks/use-telegram-auth.ts` - ‚úÖ **–û–ë–ù–û–í–õ–ï–ù** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ö—É–∫–∏ SDK v3.x)
- `src/hooks/use-token-manager.ts` - ‚úÖ **–°–û–ó–î–ê–ù** (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏)

### –°–µ—Ä–≤–∏—Å—ã:
- `src/services/token-refresh-service.ts` - ‚úÖ **–°–û–ó–î–ê–ù** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)
- `src/lib/api-client.ts` - ‚úÖ **–°–û–ó–î–ê–ù** (HTTP –∫–ª–∏–µ–Ω—Ç —Å auto-refresh)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `src/components/telegram/TelegramProvider.tsx` - ‚úÖ **–°–û–ó–î–ê–ù** (SDK v3.x wrapper)
- `src/components/telegram/TelegramSDKTest.tsx` - ‚úÖ **–°–û–ó–î–ê–ù** (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `src/app/tg/layout.tsx` - ‚úÖ **–û–ë–ù–û–í–õ–ï–ù** (–¥–æ–±–∞–≤–ª–µ–Ω TelegramProvider)

### API Endpoints:
- `src/app/api/auth/verify/route.ts` - ‚úÖ **–°–û–ó–î–ê–ù** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤)
- `src/app/api/user/location/route.ts` - ‚úÖ **–°–û–ó–î–ê–ù** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)

## üîß **–ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï:**

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SDK v3.x —Ö—É–∫–æ–≤:
```typescript
// ‚ùå –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
const launchParams = useLaunchParams(true); // SSR —Ñ–ª–∞–≥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

// ‚úÖ –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
const launchParams = useLaunchParams(); // –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
const initDataRaw = useRawInitData(); // –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö SDK v3.x:
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è initData
if (launchParams?.tgWebAppData) {
  const webAppData = launchParams.tgWebAppData;
  const initDataParts: string[] = [];
  
  if (webAppData.user) {
    initDataParts.push(`user=${encodeURIComponent(JSON.stringify(webAppData.user))}`);
  }
  if (webAppData.auth_date) {
    initDataParts.push(`auth_date=${webAppData.auth_date}`);
  }
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  
  initDataString = initDataParts.join('&');
}
```

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK:
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
<TelegramProvider debug={isDevelopment}>
  <SDKProvider acceptCustomStyles debug>
    <TelegramAuth>
      {children}
    </TelegramAuth>
  </SDKProvider>
</TelegramProvider>
```

## üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

### 1. **SDK v3.x –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** `useLaunchParams(true)` –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫–∏ –≤ v3.x
- **–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–ª–∏ SSR —Ñ–ª–∞–≥, –¥–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `init()`

### 2. **–ü–∞—Ä—Å–∏–Ω–≥ InitData:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ `tgWebAppData`
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç Telegram initData

### 3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–æ–∫–µ–Ω–∞–º–∏:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–∞–ª–∏ –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ refresh
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ 1 —á–∞—Å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

## üß™ **–ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨:**

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ SDK v3.x:
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
import { TelegramSDKTest } from '@/components/telegram/TelegramSDKTest';

<TelegramSDKTest />
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤: `üîë 3GIS Auth: ...`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "Unable to retrieve launch parameters"

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤:
- JWT —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ 1 —á–∞—Å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ü—Ä–∏ –æ—à–∏–±–∫–µ 401 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è refresh
- –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏: `Token refresh completed successfully`

## üéØ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:**

### 1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–µ–≥–æ–¥–Ω—è):**
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run dev`
- [ ] –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram Mini App
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å TelegramSDKTest –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

### 2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API endpoints (–∑–∞–≤—Ç—Ä–∞):**
- [ ] –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ endpoints –¥–ª—è auth
- [ ] –î–æ–±–∞–≤–∏—Ç—å proper error handling
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å refresh token endpoint

### 3. **–ü—Ä–æ–¥–∞–∫—à–µ–Ω –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è):**
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (iOS, Android, Desktop)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö environment variables
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ Vercel —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

## üîç **–í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø:**

### 1. **"Unable to retrieve launch parameters":**
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç TelegramProvider –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ TelegramProvider –æ–±–µ—Ä—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 2. **"Token expired" –æ—à–∏–±–∫–∏:**
- **–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–†–µ—à–µ–Ω–∏–µ:** –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞ 1 —á–∞—Å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

### 3. **–û—à–∏–±–∫–∏ –≤ development —Ä–µ–∂–∏–º–µ:**
- **–ü—Ä–∏—á–∏–Ω–∞:** SDK —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–∂–µ –≤ dev
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ debug —Ä–µ–∂–∏–º

## üìä **–ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê:**

### Console Logs –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
```
‚úÖ "üöÄ Initializing Telegram SDK v3.x..."
‚úÖ "‚úÖ Telegram SDK initialized successfully"
‚úÖ "üîë 3GIS Auth: Authentication restored from stored token"
‚úÖ "üîë 3GIS Auth: Token refresh completed successfully"
```

### –û—à–∏–±–∫–∏ –¥–ª—è –≤–Ω–∏–º–∞–Ω–∏—è:
```
‚ùå "‚ùå Telegram SDK initialization failed"
‚ùå "üîë 3GIS Auth: Authentication failed"
‚ùå "Token refresh failed"
```

## üéâ **–ò–¢–û–ì:**

**–°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ SDK v3.x –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∞!** 

–¢–µ–ø–µ—Ä—å 3GIS:
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Telegram SDK
- ‚úÖ –ò–º–µ–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ**
