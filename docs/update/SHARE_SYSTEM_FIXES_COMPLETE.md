# üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–û–ö 3GIS

## ‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. üö® Event handlers cannot be passed to Client Component props
**–ü—Ä–æ–±–ª–µ–º–∞**: Next.js 15 –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å onClick handlers –≤ Server Components
**–†–µ—à–µ–Ω–∏–µ**: 
- ‚úÖ ShareButton —É–∂–µ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `'use client'`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `typeof window !== 'undefined'` –¥–ª—è browser APIs
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `typeof navigator !== 'undefined'` –¥–ª—è navigator APIs

### 2. üóÑÔ∏è Prisma Database Schema Mismatch
**–ü—Ä–æ–±–ª–µ–º–∞**: API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª snake_case, –∞ Prisma —Å—Ö–µ–º–∞ - camelCase
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `/api/analytics/share/route.ts`:
  - `entity_type` ‚Üí `entityType`
  - `entity_id` ‚Üí `entityId`
  - `share_count` ‚Üí `shareCount`
  - `telegramChats` ‚Üí `telegramChat`

### 3. üìä ShareAnalytics Missing Columns
**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å Prisma —Å—Ö–µ–º–æ–π
**–†–µ—à–µ–Ω–∏–µ**: –ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–í–´–ü–û–õ–ù–ò–¢–ï –ü–û –ü–û–†–Ø–î–ö–£):

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å Prisma Client
npx prisma generate

# 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
npx prisma db push

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

## üîç –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost:3000/tg
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –ª—é–±–æ–º—É –∑–∞–≤–µ–¥–µ–Ω–∏—é**: /tg/business/1
3. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"** ‚Üí –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –º–æ–¥–∞–ª –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏** ‚Üí –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ Prisma ‚úÖ

---

## üìù –î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:

### ShareButton.tsx:
```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞
if (typeof navigator !== 'undefined' && navigator.share) {
  // –¢–æ–ª—å–∫–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
}

if (typeof window !== 'undefined') {
  window.open(url, '_blank');
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ SDK v3.x
if (openTelegramLink.isAvailable()) {
  openTelegramLink(tmaUrl);
}
```

### Analytics API:
```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è Prisma
const analyticsData = {
  entityType: entityType as 'BUSINESS' | 'CHAT',  // –≤–º–µ—Å—Ç–æ entity_type
  entityId: parseInt(entityId),                   // –≤–º–µ—Å—Ç–æ entity_id
  businessId: parseInt(entityId),                 // –≤–º–µ—Å—Ç–æ business_id
  // ...
};

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
await prisma.telegramChat.update({              // –≤–º–µ—Å—Ç–æ telegramChats
  data: { shareCount: { increment: 1 } }        // –≤–º–µ—Å—Ç–æ share_count
});
```

---

## ‚ö†Ô∏è –ï–°–õ–ò –û–°–¢–ê–õ–ò–°–¨ –û–®–ò–ë–ö–ò:

### Prisma –æ—à–∏–±–∫–∏:
```bash
# –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è development!)
npx prisma migrate reset

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev --name fix_share_analytics
```

### Browser APIs –æ—à–∏–±–∫–∏:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å event handlers –ø–æ–º–µ—á–µ–Ω—ã `'use client'`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç Server Components, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç onClick handlers

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —à–µ—Ä–∏–Ω–≥–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ú–æ–¥–∞–ª —à–µ—Ä–∏–Ω–≥–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ shareCount –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Vercel

## üîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **Local**: http://localhost:3000/tg/business/1
2. **Share URL**: http://localhost:3000/b/1
3. **Analytics API**: GET /api/analytics/share?entityType=BUSINESS&entityId=1

---

**üìû –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å** - –ø–∏—à–∏—Ç–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏!
