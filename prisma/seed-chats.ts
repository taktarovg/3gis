import { PrismaClient, ChatType, ChatStatus } from '@prisma/client';

const prisma = new PrismaClient();

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —á–∞—Ç–æ–≤
const chatsData = [
  // –ù—å—é-–ô–æ—Ä–∫
  {
    title: "NYC Russian Community",
    description: "–ì–ª–∞–≤–Ω–æ–µ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ù—å—é-–ô–æ—Ä–∫–∞. –û–±—â–µ–Ω–∏–µ, –Ω–æ–≤–æ—Å—Ç–∏, –ø–æ–º–æ—â—å –Ω–æ–≤–∏—á–∫–∞–º.",
    username: "nyc_russian_community",
    type: ChatType.GROUP,
    cityName: "New York",
    stateId: "NY",
    topic: "–û–±—â–µ–Ω–∏–µ",
    memberCount: 15420,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "Brooklyn Russians",
    description: "–†—É—Å—Å–∫–∏–µ –≤ –ë—Ä—É–∫–ª–∏–Ω–µ - —Ä–∞–±–æ—Ç–∞, –∂–∏–ª—å–µ, –æ–±—â–µ–Ω–∏–µ",
    username: "brooklyn_russians",
    type: ChatType.GROUP,
    cityName: "New York",
    stateId: "NY", 
    topic: "–†–∞–π–æ–Ω",
    memberCount: 8930,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "NYC –†–∞–±–æ—Ç–∞ –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö",
    description: "–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –≤ –ù—å—é-–ô–æ—Ä–∫–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ–≤–æ—Ä—è—â–∏—Ö. –í–∞–∫–∞–Ω—Å–∏–∏, —Ä–µ–∑—é–º–µ, —Å–æ–≤–µ—Ç—ã.",
    inviteLink: "https://t.me/+abc123_nyc_jobs",
    type: ChatType.GROUP,
    cityName: "New York",
    stateId: "NY",
    topic: "–†–∞–±–æ—Ç–∞",
    memberCount: 12340,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },
  {
    title: "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å NYC Russians",
    description: "–ê—Ä–µ–Ω–¥–∞, –ø–æ–∫—É–ø–∫–∞, –ø—Ä–æ–¥–∞–∂–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –ù—å—é-–ô–æ—Ä–∫–µ",
    username: "nyc_real_estate_ru", 
    type: ChatType.CHANNEL,
    cityName: "New York",
    stateId: "NY",
    topic: "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å",
    memberCount: 6780,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },
  {
    title: "Queens Russian Moms",
    description: "–ú–∞–º–æ—á–∫–∏ —Ä—É—Å—Å–∫–æ–≥–æ–≤–æ—Ä—è—â–∏–µ –≤ –ö–≤–∏–Ω—Å–µ - –¥–µ—Ç–∏, —à–∫–æ–ª—ã, —Ä–∞–∑–≤–∏—Ç–∏–µ",
    inviteLink: "https://t.me/+def456_queens_moms",
    type: ChatType.GROUP,
    cityName: "New York",
    stateId: "NY",
    topic: "–°–µ–º—å—è",
    memberCount: 4560,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å
  {
    title: "LA Russian Community",
    description: "–†—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å–∞. West Hollywood, Beverly Hills, Santa Monica.",
    username: "la_russian_community",
    type: ChatType.GROUP,
    cityName: "Los Angeles",
    stateId: "CA",
    topic: "–û–±—â–µ–Ω–∏–µ",
    memberCount: 13280,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "Hollywood Russians",
    description: "–†—É—Å—Å–∫–∏–µ –≤ –ì–æ–ª–ª–∏–≤—É–¥–µ - –∫–∏–Ω–æ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥",
    username: "hollywood_russians",
    type: ChatType.GROUP,
    cityName: "Los Angeles", 
    stateId: "CA",
    topic: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ",
    memberCount: 7890,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },
  {
    title: "LA –†–∞–±–æ—Ç–∞ IT",
    description: "IT –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ –õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ–≤–æ—Ä—è—â–∏—Ö",
    inviteLink: "https://t.me/+ghi789_la_it_jobs",
    type: ChatType.CHANNEL,
    cityName: "Los Angeles",
    stateId: "CA",
    topic: "IT",
    memberCount: 5420,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –ß–∏–∫–∞–≥–æ
  {
    title: "Chicago Russians",
    description: "–†—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ß–∏–∫–∞–≥–æ. Devon Avenue, Ukrainian Village.",
    username: "chicago_russians",
    type: ChatType.GROUP,
    cityName: "Chicago",
    stateId: "IL",
    topic: "–û–±—â–µ–Ω–∏–µ",
    memberCount: 8760,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "–ß–∏–∫–∞–≥–æ –ë–∞—Ä–∞—Ö–æ–ª–∫–∞",
    description: "–ü–æ–∫—É–ø–∫–∞-–ø—Ä–æ–¥–∞–∂–∞ –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –≤ –ß–∏–∫–∞–≥–æ",
    inviteLink: "https://t.me/+jkl012_chicago_marketplace",
    type: ChatType.GROUP,
    cityName: "Chicago",
    stateId: "IL",
    topic: "–¢–æ—Ä–≥–æ–≤–ª—è",
    memberCount: 3450,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –ú–∞–π–∞–º–∏
  {
    title: "Miami Russian Beach",
    description: "–†—É—Å—Å–∫–∏–µ –≤ –ú–∞–π–∞–º–∏ - —Å–æ–ª–Ω—Ü–µ, –º–æ—Ä–µ, –ø–ª—è–∂, –±–∏–∑–Ω–µ—Å",
    username: "miami_russian_beach",
    type: ChatType.GROUP,
    cityName: "Miami",
    stateId: "FL",
    topic: "–û–±—â–µ–Ω–∏–µ",
    memberCount: 9340,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "Miami –ë–∏–∑–Ω–µ—Å",
    description: "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –ú–∞–π–∞–º–∏",
    inviteLink: "https://t.me/+mno345_miami_business",
    type: ChatType.GROUP,
    cityName: "Miami",
    stateId: "FL",
    topic: "–ë–∏–∑–Ω–µ—Å",
    memberCount: 4680,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –°–∞–Ω-–§—Ä–∞–Ω—Ü–∏—Å–∫–æ
  {
    title: "SF Bay Area Russians",
    description: "–†—É—Å—Å–∫–∏–µ –≤ –æ–±–ª–∞—Å—Ç–∏ –∑–∞–ª–∏–≤–∞ –°–∞–Ω-–§—Ä–∞–Ω—Ü–∏—Å–∫–æ. –ö—Ä–µ–º–Ω–∏–µ–≤–∞—è –¥–æ–ª–∏–Ω–∞, –ü–∞–ª–æ-–ê–ª—å—Ç–æ.",
    username: "sf_bay_russians",
    type: ChatType.GROUP,
    cityName: "San Francisco",
    stateId: "CA",
    topic: "–û–±—â–µ–Ω–∏–µ",
    memberCount: 6890,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },
  {
    title: "Silicon Valley –†—É—Å—Å–∫–∏–µ",
    description: "IT —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≤ –ö—Ä–µ–º–Ω–∏–µ–≤–æ–π –¥–æ–ª–∏–Ω–µ - Google, Apple, Meta, —Å—Ç–∞—Ä—Ç–∞–ø—ã",
    username: "silicon_valley_ru",
    type: ChatType.GROUP,
    cityName: "San Francisco",
    stateId: "CA",
    topic: "IT",
    memberCount: 11240,
    isVerified: true,
    status: ChatStatus.ACTIVE
  },

  // –ë–æ—Å—Ç–æ–Ω
  {
    title: "Boston Russian Hub",
    description: "–†—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ë–æ—Å—Ç–æ–Ω–∞. –ö–µ–º–±—Ä–∏–¥–∂, MIT, –ì–∞—Ä–≤–∞—Ä–¥.",
    inviteLink: "https://t.me/+pqr678_boston_hub",
    type: ChatType.GROUP,
    cityName: "Boston",
    stateId: "MA",
    topic: "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
    memberCount: 4320,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –°–∏—ç—Ç–ª
  {
    title: "Seattle Russian Tech",
    description: "IT –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –°–∏—ç—Ç–ª–µ - Amazon, Microsoft, —Å—Ç–∞—Ä—Ç–∞–ø—ã",
    username: "seattle_russian_tech",
    type: ChatType.GROUP,
    cityName: "Seattle",
    stateId: "WA",
    topic: "IT",
    memberCount: 5670,
    isVerified: false,
    status: ChatStatus.ACTIVE
  },

  // –¢–µ—Å—Ç–æ–≤—ã–µ —á–∞—Ç—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  {
    title: "Test Pending Chat",
    description: "–¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏",
    username: "test_pending",
    type: ChatType.GROUP,
    cityName: "New York",
    stateId: "NY",
    topic: "–¢–µ—Å—Ç",
    memberCount: 10,
    isVerified: false,
    status: ChatStatus.PENDING
  },
  {
    title: "Rejected Chat Example",
    description: "–ü—Ä–∏–º–µ—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–æ–≥–æ —á–∞—Ç–∞",
    inviteLink: "https://t.me/+rejected_example",
    type: ChatType.GROUP,
    cityName: "Los Angeles",
    stateId: "CA",
    topic: "–¢–µ—Å—Ç",
    memberCount: 5,
    isVerified: false,
    status: ChatStatus.REJECTED
  }
];

async function seedChats() {
  try {
    console.log('üå± –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —á–∞—Ç–æ–≤...');

    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –∏ —à—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–≤—è–∑–∏
    const cities = await prisma.city.findMany({
      select: { id: true, name: true, stateId: true }
    });

    const states = await prisma.state.findMany({
      select: { id: true, name: true }
    });

    console.log(`üìç –ù–∞–π–¥–µ–Ω–æ –≥–æ—Ä–æ–¥–æ–≤: ${cities.length}, —à—Ç–∞—Ç–æ–≤: ${states.length}`);

    // –°–æ–∑–¥–∞–µ–º —á–∞—Ç—ã
    let createdCount = 0;
    
    for (const chatData of chatsData) {
      try {
        // –ù–∞—Ö–æ–¥–∏–º ID –≥–æ—Ä–æ–¥–∞
        const city = cities.find(c => 
          c.name.toLowerCase() === chatData.cityName.toLowerCase() && 
          c.stateId === chatData.stateId
        );

        if (!city) {
          console.log(`‚ö†Ô∏è  –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω: ${chatData.cityName}, ${chatData.stateId}`);
          continue;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —á–∞—Ç —Å —Ç–∞–∫–∏–º username –∏–ª–∏ title
        const existingChat = await prisma.telegramChat.findFirst({
          where: {
            OR: [
              { username: chatData.username },
              { title: chatData.title }
            ]
          }
        });

        if (existingChat) {
          console.log(`‚è≠Ô∏è  –ß–∞—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${chatData.title}`);
          continue;
        }

        // –°–æ–∑–¥–∞–µ–º —á–∞—Ç
        const { cityName, ...createData } = chatData;
        const chat = await prisma.telegramChat.create({
          data: {
            ...createData,
            cityId: city.id,
            viewCount: Math.floor(Math.random() * 1000), // –°–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
            joinCount: Math.floor(Math.random() * 100),   // –°–ª—É—á–∞–π–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
          }
        });

        console.log(`‚úÖ –°–æ–∑–¥–∞–Ω —á–∞—Ç: ${chat.title} (ID: ${chat.id})`);
        createdCount++;

      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞ "${chatData.title}":`, error);
      }
    }

    console.log(`üéâ –°–æ–∑–¥–∞–Ω–æ —á–∞—Ç–æ–≤: ${createdCount}/${chatsData.length}`);

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º
    const stats = await prisma.telegramChat.groupBy({
      by: ['type', 'status'],
      _count: true
    });

    console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–æ–≤:');
    stats.forEach(stat => {
      console.log(`   ${stat.type} (${stat.status}): ${stat._count} —à—Ç.`);
    });

    return { success: true, created: createdCount };

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —á–∞—Ç–æ–≤:', error);
    throw error;
  }
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º seed —Ñ–∞–π–ª–µ
export { seedChats };

// –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
  seedChats()
    .then((result) => {
      console.log('‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:', result);
      process.exit(0);
    })
    .catch((error) => {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:', error);
      process.exit(1);
    })
    .finally(() => {
      prisma.$disconnect();
    });
}
